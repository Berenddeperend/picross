var ye=Object.defineProperty,ge=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var oe=(l,t,e)=>t in l?ye(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,D=(l,t)=>{for(var e in t||(t={}))Ce.call(t,e)&&oe(l,e,t[e]);if(ne)for(var e of ne(t))ke.call(t,e)&&oe(l,e,t[e]);return l},se=(l,t)=>ge(l,he(t));import{r as B,o as i,c as d,a as k,F as $,b as f,d as b,e as X,f as j,g as S,h as T,u as c,i as U,j as G,n as A,t as V,l as R,k as ae,w as K,m as ze,p as be,q as re,s as w,v as Y,x as I,y as J,z as F,A as ie,B as $e,C as we,T as Ie,D as xe,E as W,G as Z,H as Q,I as ue,J as Se,K as Te,L as Pe}from"./vendor.2745e27f.js";const Me=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}};Me();var E=(l,t)=>{const e=l.__vccOpts||l;for(const[o,n]of t)e[o]=n;return e};const Ne={},Ue=f("div",{id:"modal-target"},null,-1);function Ge(l,t){const e=B("router-view");return i(),d($,null,[k(e),Ue],64)}var Ve=E(Ne,[["render",Ge]]);const H=b({spacePressed:!1,intention:"build"});function Ee(l){const{toggleCellValue:t,movePlayerCursor:e}=l;function o(n){n.key==="ArrowLeft"?(e("left"),H.value.spacePressed&&t("d")):n.key==="ArrowRight"?(e("right"),H.value.spacePressed&&t("d")):n.key==="ArrowUp"?(e("up"),H.value.spacePressed&&t("d")):n.key==="ArrowDown"?(e("down"),H.value.spacePressed&&t("d")):n.key==="f"?t("x"):n.key===" "&&(H.value.spacePressed=!0,t("d"))}X(()=>{window.addEventListener("keydown",o),window.addEventListener("keyup",n=>{n.key===" "&&(H.value.spacePressed=!1)})}),j(()=>{window.removeEventListener("keydown",o)})}const Oe={key:0,class:"corner"},Le={key:1,class:"legend horizontal"},Ae={key:2,class:"legend vertical"},Re=["onMouseover","onClick","onContextmenu","i"],He=S({props:{enableControls:{type:Boolean,default:!1},enableSocket:{type:Boolean,default:!1},players:null,player:null,game:null},emits:["onCellClicked","onCellRightClicked","gridChanged","moveCursor","toggleCellValue","onCellHover"],setup(l,{emit:t}){const{gridSize:e,indexToXY:o,hitsInColumns:n,hitsInRows:s,levelIsCleared:a,grid:u,solution:m}=l.game,z=T(()=>{var r;return(r=l.player)==null?void 0:r.position});l.enableControls&&Ee({toggleCellValue:r=>{t("toggleCellValue",r)},movePlayerCursor:r=>{t("moveCursor",r)}});function y(r){if(!(!z||!l.player||!l.players||R.exports.isEqual(o(r),z))&&l.enableSocket){const N=Object.values(l.players).find(_=>R.exports.isEqual(o(r),_.position));return N?`box-shadow: 0px 0px 0px 2px ${N.color}; z-index: 2;`:void 0}}const P=T(()=>{const r=c(m)?"auto repeat(10, 1fr)":"repeat(10, 1fr)";return`
    grid-template-columns: ${r};
    grid-template-rows: ${r};
  `});function C(r,x){const[N,_]=o(r);return c(u)[_][N]===x}function M(r){if(!!l.player)return l.player.position[0]===r}function p(r){if(!!l.player)return l.player.position[1]===r}function h(r){!l.enableControls||t("onCellClicked",r)}function v(r){!l.enableControls||t("onCellRightClicked",r)}function g(r){!l.enableControls||t("onCellHover",r)}return(r,x)=>(i(),d("div",{class:A(["playfield-container",{cleared:c(a)}]),style:ae(c(P))},[c(m)?(i(),d("div",Oe)):U("",!0),c(m)?(i(),d("div",Le,[(i(!0),d($,null,G(c(e),(N,_)=>(i(),d("div",{class:A(["cell",{highlighted:M(_)}]),key:_},[(i(!0),d($,null,G(c(n)[_],(O,L)=>(i(),d("div",{key:L,class:"hit"},V(O),1))),128))],2))),128))])):U("",!0),c(m)?(i(),d("div",Ae,[(i(!0),d($,null,G(c(e),(N,_)=>(i(),d("div",{class:A(["cell",{highlighted:p(_)}]),key:_},[(i(!0),d($,null,G(c(s)[_],(O,L)=>(i(),d("div",{key:L,class:"hit"},V(O),1))),128))],2))),128))])):U("",!0),(i(!0),d($,null,G(c(e)*c(e),(N,_)=>{var O;return i(),d("div",{class:A(["cell",{cursor:c(R.exports.isEqual)((O=l.player)==null?void 0:O.position,c(o)(_)),filled:C(_,"d"),flagged:C(_,"x")}]),key:_,style:ae(y(_)),onMouseover:L=>g(_),onClick:L=>h(_),onContextmenu:K(L=>v(_),["right","prevent"]),i:_},null,46,Re)}),128))],6))}});var ee=E(He,[["__scopeId","data-v-5c119636"]]);function te(l){return new Array(l).fill("").map(t=>new Array(l).fill(" "))}const Be=()=>{const l=!0,t={transports:["websocket"],upgrade:!1};console.log("isProd",l);const e=ze({}.VUE_SOCKET_BASE_URL,D({path:{}.VUE_SOCKET_PATH},t));return j(()=>{e.disconnect()}),{socket:e}};function ce(l,t,e){const o=l==="multiplayer";let n=b(null),s=b({});o||(n.value="1",s.value={"1":{id:"1",position:[0,0],color:"green",name:"berend"}});const a=T(()=>{var y;return(y=u==null?void 0:u.value)==null?void 0:y.position}),u=T(()=>n.value!==null?s.value[n.value]:null);function m(y){s.value=y}function z(){X(()=>{!o||(e.on("gridUpdated",t.setGrid),e.on("playersStateUpdated",m),e.on("playerCreated",y=>{n.value=y.id}),e.on("gameCreated",y=>t.setSolution(y.solution)),e.emit("join",localStorage.getItem("nickName")))}),j(()=>{!o||(e.off("gridUpdated",y=>t.setGrid(y)),e.off("playersStateUpdated",m))})}return{players:s,player:u,playerId:n,cursor:a,initState:z}}function de(l){return l.reduce((t,e,o,n)=>(e==="d"&&(t.length>0&&n[o-1]==="d"?t[t.length-1]++:t.push(1)),t),[])}function pe(l){return l.map(t=>de(t))}function ve(l){const t=l.map((e,o,n)=>n.map(s=>s[o]));return t==null?void 0:t.map(e=>de(e))}const le=(l,t)=>{const e=b(l||te(10)),o=b(t||null),n=C=>{e.value=C},s=C=>{o.value=C},a=T(()=>e.value[0].length),u=C=>{const M=C%a.value,p=Math.floor(C/a.value);return[M,p]},m=C=>R.exports.clamp(C,0,a.value-1),z=T(()=>R.exports.isEqual(e.value,o==null?void 0:o.value)),y=T(()=>pe(o.value)),P=T(()=>ve(o.value));return{grid:e,solution:o,gridSize:a,hitsInRows:y,hitsInColumns:P,computeHitsInRows:pe,computeHitsInColumns:ve,levelIsCleared:z,indexToXY:u,clampToGrid:m,setGrid:n,setSolution:s}},q=be.create({baseURL:{}.VUE_API_URL});const fe=l=>(J("data-v-f4fa7640"),l=l(),F(),l),Ye=I("\u2190 Back"),qe={class:"container"},De=fe(()=>f("br",null,null,-1)),Xe={class:"now-playing"},je=fe(()=>f("span",{class:"online-indicator"},null,-1)),Ke=S({props:{puzzleId:null},setup(l){const t=l.puzzleId?"singleplayer":"multiplayer",e=le(te(10)),{grid:o}=e;t==="singleplayer"&&q.get(`/puzzle/${l.puzzleId}`).then(p=>{e.setSolution(JSON.parse(p.data.puzzle))});const{socket:n}=Be(),{players:s,player:a,initState:u}=ce(t,e,n);u();function m(p){const[h,v]=e.indexToXY(p);o.value[v][h]=o.value[v][h]===" "?"d":" ",n.emit("gridUpdated",o.value)}function z(p){const[h,v]=e.indexToXY(p);o.value[v][h]=o.value[v][h]===" "?"x":" ",n.emit("gridUpdated",o.value)}function y(p){p==="left"&&(a.value.position[0]=e.clampToGrid(a.value.position[0]-1)),p==="right"&&(a.value.position[0]=e.clampToGrid(a.value.position[0]+1)),p==="up"&&(a.value.position[1]=e.clampToGrid(a.value.position[1]-1)),p==="down"&&(a.value.position[1]=e.clampToGrid(a.value.position[1]+1)),n.emit("cursorUpdated",a.value.position)}function P(p){a.value.position=e.indexToXY(p),n.emit("cursorUpdated",a.value.position)}function C(p){if(e.levelIsCleared.value)return;const[h,v]=a.value.position;o.value[v][h]=o.value[v][h]===p?" ":p,n.emit("gridUpdated",o.value)}function M(p){var h;return p.id===((h=a.value)==null?void 0:h.id)}return re(e.levelIsCleared,p=>{p&&(ie({zIndex:-1,particleCount:50,spread:70,angle:60,origin:{y:.6}}),ie({zIndex:-1,particleCount:50,spread:70,angle:120,origin:{y:.6}}))}),(p,h)=>{const v=B("router-link");return i(),d($,null,[f("header",null,[k(v,{class:"link",to:{name:"mainMenu"}},{default:w(()=>[Ye]),_:1})]),f("div",qe,[c(e).grid&&c(e).solution?(i(),Y(ee,{key:0,class:"grid","enable-controls":!0,"enable-socket":!0,game:c(e),player:c(a),players:c(s),onOnCellClicked:m,onOnCellRightClicked:z,onOnCellHover:P,onMoveCursor:y,onToggleCellValue:C},null,8,["game","player","players"])):U("",!0),f("aside",null,[De,f("span",Xe,"Now playing ("+V(Object.values(c(s)).length)+")",1),f("ul",null,[(i(!0),d($,null,G(c(s),g=>(i(),d("li",{class:A([{"current-player":M(g)},g.id]),ref_for:!0,ref:"playersRef"},[je,I(" "+V(g.name),1)],2))),256))])])])],64)}}});var _e=E(Ke,[["__scopeId","data-v-f4fa7640"]]);const Je={class:"modal"},Fe=S({props:{visible:{type:Boolean}},emits:["close"],setup(l,{emit:t}){return $e("Escape",()=>{!l.visible||t("close")}),(e,o)=>(i(),Y(xe,{to:"#modal-target"},[k(Ie,null,{default:w(()=>[l.visible?(i(),d("div",{key:0,class:"backdrop",onClick:o[0]||(o[0]=K(n=>e.$emit("close"),["self"]))},[f("div",Je,[we(e.$slots,"default",{},void 0,!0)])])):U("",!0)]),_:3})]))}});var me=E(Fe,[["__scopeId","data-v-2272df04"]]);const We=["onSubmit"],Ze=["disabled"],Qe={key:1},et=S({props:{open:null,grid:null},emits:["close"],setup(l,{emit:t}){const e=b(""),o=W("nickName",""),n=b();function s(a){q.post("/puzzle",{name:e.value,solution:JSON.stringify(l.grid),authorName:o.value}).then(u=>{t("close")}).catch(u=>{u.response.status&&(n.value="You've already submitted the same puzzle before.",setTimeout(()=>{t("close"),n.value=""},2e3))})}return(a,u)=>(i(),Y(me,{visible:l.open,onClose:u[2]||(u[2]=m=>t("close"))},{default:w(()=>[n.value?(i(),d("p",Qe,V(n.value),1)):(i(),d("form",{key:0,onSubmit:K(s,["prevent"])},[I(V(c(o))+" ",1),Z(f("input",{type:"text",placeholder:"Uw naam","onUpdate:modelValue":u[0]||(u[0]=m=>ue(o)?o.value=m:null)},null,512),[[Q,c(o)]]),Z(f("input",{type:"text",placeholder:"Puzzel naam","onUpdate:modelValue":u[1]||(u[1]=m=>e.value=m)},null,512),[[Q,e.value]]),f("button",{disabled:e.value===""||c(o)===""},"Save",8,Ze)],40,We))]),_:1},8,["visible"]))}}),tt=f("p",null,"De puzzel is niet goed.",-1),lt=S({props:{open:null},emits:["close"],setup(l,{emit:t}){return(e,o)=>(i(),Y(me,{visible:l.open,onClose:o[0]||(o[0]=n=>t("close"))},{default:w(()=>[tt]),_:1},8,["visible"]))}});const nt=l=>(J("data-v-9cdc5990"),l=l(),F(),l),ot={class:"create"},st=I("\u2190 Back"),at={class:"btns-container"},rt=nt(()=>f("button",{class:"btn btn-link"},"Clear",-1)),it=S({setup(l){const t=b(!1),e=b(!1),o=le(te(10)),{grid:n,computeHitsInRows:s,computeHitsInColumns:a}=o;console.log("-> grid",n);const{player:u}=ce("singleplayer",o),m=b(!1),z=b(!1);function y(){const v=x=>x.length?x:[0],g=a(n.value).map(v),r=s(n.value).map(v);q.post("/validate-puzzle",{legendData:{rows:r,columns:g}}).then(x=>{m.value=!0,z.value=x.data})}const P=R.exports.debounce(y,400);function C(v){if(t.value||o.levelIsCleared.value)return;const[g,r]=u.value.position;n.value[r][g]=n.value[r][g]===v?" ":v}function M(v){const[g,r]=o.indexToXY(v);n.value[r][g]=n.value[r][g]===" "?"d":" "}function p(v){t.value||(v==="left"&&(u.value.position[0]=o.clampToGrid(u.value.position[0]-1)),v==="right"&&(u.value.position[0]=o.clampToGrid(u.value.position[0]+1)),v==="up"&&(u.value.position[1]=o.clampToGrid(u.value.position[1]-1)),v==="down"&&(u.value.position[1]=o.clampToGrid(u.value.position[1]+1)))}function h(){z.value?t.value=!0:e.value=!0}return re(n,()=>{m.value=!1,P()},{deep:!0}),(v,g)=>{const r=B("router-link");return i(),d("div",ot,[f("header",null,[k(r,{class:"link",to:{name:"mainMenu"}},{default:w(()=>[st]),_:1})]),k(lt,{open:e.value,onClose:g[0]||(g[0]=x=>e.value=!1)},null,8,["open"]),k(et,{open:t.value,onClose:g[1]||(g[1]=x=>t.value=!1),grid:c(n)},null,8,["open","grid"]),k(ee,{"enable-controls":!0,game:c(o),player:c(u),onOnCellClicked:M,onMoveCursor:p,onToggleCellValue:C},null,8,["game","player"]),f("div",at,[rt,f("button",{class:A(["btn",{disabled:!z.value}]),onClick:h}," Save puzzle ",2)])])}}});var ut=E(it,[["__scopeId","data-v-9cdc5990"]]);const ct=l=>(J("data-v-e2bfbde6"),l=l(),F(),l),dt=ct(()=>f("h1",null,"Picross",-1)),pt=I(" Nickname "),vt={class:"input-with-button"},ft=I("Play"),_t=I("Play"),mt=I("Create Level"),yt=I("My puzzles"),gt=S({setup(l){const t=W("nickName","");return(e,o)=>{const n=B("router-link");return i(),d($,null,[dt,f("label",null,[pt,f("div",vt,[Z(f("input",{type:"text",autofocus:"","onUpdate:modelValue":o[0]||(o[0]=s=>ue(t)?t.value=s:null)},null,512),[[Q,c(t)]]),k(n,{class:"btn",to:"/play"},{default:w(()=>[ft]),_:1})])]),f("ul",null,[f("li",null,[k(n,{to:"/play"},{default:w(()=>[_t]),_:1})]),f("li",null,[k(n,{to:"/create"},{default:w(()=>[mt]),_:1})]),f("li",null,[k(n,{to:"/my-puzzles"},{default:w(()=>[yt]),_:1})])])],64)}}});var ht=E(gt,[["__scopeId","data-v-e2bfbde6"]]);const Ct=I("Back"),kt={key:0},zt={key:1,class:"my-puzzles"},bt=I("Play"),$t=S({setup(l){const t=b(),e=W("nickName","Berend");return X(()=>{!e.value||q.get(`/users/${e.value}/puzzles`).then(o=>{t.value=o.data.map(n=>{const s=JSON.parse(n.solution);return se(D({},n),{game:le(s,s)})})})}),(o,n)=>{const s=B("router-link");return i(),d($,null,[k(s,{to:{name:"mainMenu"}},{default:w(()=>[Ct]),_:1}),c(e)?U("",!0):(i(),d("div",kt,"No puzzles yet.")),t.value?(i(),d("div",zt,[(i(!0),d($,null,G(t.value,a=>(i(),d("div",{class:"puzzle",key:a.id},[f("h3",null,V(a.name),1),k(ee,{"enable-controls":!1,game:a.game},null,8,["game"]),k(s,{to:{name:"singleplayer",params:{puzzleId:a.id}}},{default:w(()=>[bt]),_:2},1032,["to"])]))),128))])):U("",!0)],64)}}});var wt=E($t,[["__scopeId","data-v-694a5946"]]);const It=[{name:"mainMenu",path:"/",component:ht},{name:"multiplayer",path:"/play",component:_e},{name:"singleplayer",path:"/play/singleplayer/:puzzleId",component:_e,props:!0},{name:"create",path:"/create",component:ut},{name:"myPuzzles",path:"/my-puzzles",component:wt}],xt=Se({history:Te(),routes:It});Pe(Ve).use(xt).mount("#app");
